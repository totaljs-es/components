<style>.ui-permissions-container{display:grid;grid-template-columns:1fr repeat(var(--permissions-cols,4),max-content);border:1px solid #E0E0E0;border-radius:var(--radius);width:100%}.ui-permissions-row{display:contents}.ui-permissions-cell{padding:8px;border-top:1px solid #E0E0E0;border-left:1px solid #e0e0e0}.ui-permissions-row:first-of-type .ui-permissions-cell{border-top:0}.ui-permissions-row .ui-permissions-cell:first-child{border-left:0}.ui-permissions-headerrow{display:contents}.ui-permissions-headerbutton{height:22px;line-height:21px;background-color:#fff;padding:0 8px;color:#000;border:1px solid #e0e0e0;border-radius:var(--radius);font-size:11px}.ui-permissions-headerbutton i{color:#68B25B}.ui-permissions-headerbutton:hover{border-color:#d0d0d0}.ui-permissions-headercell{background:#f0f0f0;font-size:11px;border-top:0;color:#909090;width:70px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center;line-height:24px}.ui-permissions-headerrow .ui-permissions-headercell:first-child{justify-content:flex-start;border-radius:var(--radius) 0 0 0;border-left:0;width:100%;text-align:left}.ui-permissions-headerrow .ui-permissions-headercell:last-child{border-radius:0 var(--radius) 0 0}.ui-permissions-text{display:flex;align-items:center;justify-content:flex-start;font-size:13px}.ui-permissions-remove{margin-right:8px;margin-bottom:1px;cursor:pointer}.ui-permissions-type{cursor:pointer;color:#999;font-size:10px;display:flex;align-items:center;justify-content:center;width:70px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ui-permissions-type i{width:20px;height:20px;line-height:20px;font-size:13px;text-align:center;border:1px solid #d0d0d0;border-radius:4px;background:#fff;transform:scale(1) !important}.ui-permissions-type i:before{content:''}.ui-permissions-type.ui-permissions-checked i:before{content:'\e956'}.ui-permissions-checked{color:#000}.ui-permissions-checked i{color:inherit}.ui-permissions-empty{color:#A0A0A0;font-size:12px;padding:10px;text-align:center}.ui-permissions-empty i{margin-right:5px;margin-bottom:1px}.ui-permissions.ui-disabled .ui-permissions-type{cursor:not-allowed}.ui-permissions.ui-disabled .ui-permissions-type i{background-color:#f8f8f8;color:silver}.ui-permissions.ui-disabled .ui-permissions-headerbutton{pointer-events:none;color:silver;background-color:#f8f8f8}.ui-permissions.ui-disabled .ui-permissions-headerbutton i{color:silver !important}.ui-permissions.ui-disabled .ui-permissions-text i{color:silver !important;cursor:not-allowed}.ui-dark .ui-permissions-container{border-color:#404040}.ui-dark .ui-permissions .ui-permissions-cell{border-color:#404040;background-color:#252525}.ui-dark .ui-permissions-checked{background-color:#313131;color:#FFF}.ui-dark .ui-permissions-headercell{background:#282828 !important;color:#FFF}.ui-dark .ui-permissions-headerbutton{background-color:#202020;border-color:#333;color:#c0c0c0}.ui-dark .ui-permissions-type i{border-color:#404040;background:#252525}.ui-dark .ui-permissions-type.ui-permissions-checked i:before{color:#fff}.ui-dark .ui-permissions.ui-disabled .ui-permissions-headerbutton{color:#666;border-color:#404040 !important;background-color:#303030}.ui-dark .ui-permissions.ui-disabled .ui-permissions-headerbutton i{color:#666 !important}.ui-dark .ui-permissions.ui-disabled .ui-permissions-type i{background-color:#282828;border-color:#303030}.ui-dark .ui-permissions.ui-disabled .ui-permissions-type i:before{color:#999 !important}</style>
<script>COMPONENT('permissions@1','placeholder:Search;types:C,R,U,D;default:R;autoremove:1;autoexclude:1;button:Add',function(self,config,cls){var cls2='.'+cls,dirsource=EMPTYARRAY,types=EMPTYARRAY,tbody;self.configure=function(key,value,cls){switch(key){case'types':types=value.split(',');for(let i=0;i<types.length;i++){let tmp=types[i].split('|');types[i]={id:tmp[0],name:tmp[1]||tmp[0]}}self.recompile();break;case'dirsource':if(value){if(value.includes(',')){dirsource=value.parseSource();self.redraw()}else{self.datasource(value,function(value,path){dirsource=CLONE(M.is20?value:path);self.redraw()})}}break}};self.redraw=function(){setTimeout2(self.ID,self.redrawforce,50)};self.redrawforce=function(){if(!dirsource)return;let items=self.get();tbody.empty();tbody.append(self.header);if(!items||!items.length){config.empty&&tbody.append('<div class="{0}-row"><div class="{0}-cell {0}-empty" style="grid-column:1 / span {1}"><i class="ti ti-database"></i>{2}</div></div>'.format(cls,types.length+1,config.empty));return}let builder=[];let remove=[];let cache={};for(let m of items){let op=m.substring(0,1);let who=m.substring(1);if(cache[who])cache[who].push(op);else cache[who]=[op]}for(let key in cache){let name=dirsource.findValue('id',key,'name');if(name)builder.push(self.template({id:key,name:name,value:cache[key]}));else if(config.autoremove)remove.push(key)}if(remove.length){for(let m of remove)items.splice(items.indexOf(m),1)}if(items.length)tbody.append(builder.join(''));else config.empty&&tbody.append('<div class="{0}-row"><div class="{0}-cell {0}-empty" style="grid-column:1 / span {1}"><i class="ti ti-database"></i>{2}</div></div>'.format(cls,types.length+1,config.empty))};self.recompile=function(){var builder=['<div class="{0}-row" data-id="{{ id}}">'];builder.push('<div class="{0}-cell {0}-text"><i class="ti ti-trash {0}-remove red"></i>{{ name | raw}}</div>');for(let type of types){builder.push('<div class="{0}-cell {0}-type{{ if value.includes(\'{1}\') }} {0}-checked{{ fi}}" data-type="{1}"><i class="ti"></i></div>'.format(cls,type.id))}builder.push('</div>');self.template=Tangular.compile(builder.join('').format(cls));self.find('.'+cls+'-container').css('--permissions-cols',types.length);self.header='<div class="{0}-headerrow">'.format(cls);self.header+='<div class="{0}-cell {0}-headercell"><button class="{0}-headerbutton"><i class="ti ti-plus-circle mr5"></i>{1}</button></div>'.format(cls,config.button);for(let type of types){self.header+='<div class="{0}-cell {0}-headercell" title="{1}">{1}</div>'.format(cls,type.name)}self.header+='</div>'};self.make=function(){self.aclass(cls);self.html('<div class="{0}-container invisible"></div>'.format(cls));tbody=self.find('.'+cls+'-container');self.event('click',cls2+'-type',function(){if(config.disabled)return;let el=$(this);let row=el.closest(cls2+'-row');el.tclass(cls+'-checked');let id=row.attrd('id');let items=self.get()||[];let typesel=[];row.find('.'+cls+'-checked').each(function(){let checked=$(this);let type=checked.attrd('type');typesel.push(type)});items=items.remove(n=>n.substring(1)===id);for(let type of typesel)items.push(type+id);self.bind('@modified @touched',items);config.exec&&self.EXEC(config.exec,items)});self.event('click',cls2+'-headerbutton',function(){if(config.disabled)return;let items=self.get()||[];let opt={};let used={};for(let m of items){let id=m.substring(1);used[id]=1}opt.raw=!!config.dirraw;opt.element=$(this).closest('.'+cls+'-headercell');opt.placeholder=config.placeholder;opt.items=dirsource;if(config.autoexclude)opt.exclude=item=>used[item.id];opt.callback=function(selected){if(!used[selected.id]){items.push(types[0].id+selected.id);self.bind('@modified @touched @setter',items);config.exec&&self.EXEC(config.exec,items)}};SETTER('directory/show',opt)});self.event('click',cls2+'-remove',function(){if(config.disabled)return;var el=$(this);var id=el.closest(cls2+'-row').attrd('id');var items=self.get();items=items.remove(n=>n.substring(1)===id);self.bind('@modified @touched @setter',items);config.exec&&self.EXEC(config.exec,items)})};self.setter=function(){self.redraw();self.find(cls2+'-container').rclass('invisible')}});</script>